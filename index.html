<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM Tutoring</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
        }
        .text-gradient {
            background: linear-gradient(90deg, #58a6ff, #8b949e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card {
            @apply bg-[#161b22] border border-[#30363d] rounded-2xl shadow-xl transition-transform duration-300 transform hover:scale-105 hover:shadow-2xl;
        }
        .qualification-item {
            @apply flex items-start gap-2 text-sm sm:text-base text-[#8b949e] py-1.5;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-6">
    <div class="w-full max-w-4xl p-8 bg-[#161b22] rounded-2xl shadow-lg">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-gradient mb-2">STEM Tutoring</h1>
            <p class="text-lg sm:text-xl text-[#8b949e]">Personalized tutoring in Mathematics and Science.</p>
        </header>

        <!-- Navigation Bar -->
        <nav class="mb-8">
            <ul class="flex flex-col sm:flex-row justify-center items-center gap-4 text-lg font-medium">
                <li><a href="#" data-page="home" class="nav-link text-[#c9d1d9] hover:text-[#58a6ff] transition-colors duration-200">Home</a></li>
                <li><a href="#" data-page="mathematics" class="nav-link text-[#c9d1d9] hover:text-[#58a6ff] transition-colors duration-200">Mathematics</a></li>
                <li><a href="#" data-page="science-olympiad" class="nav-link text-[#c9d1d9] hover:text-[#58a6ff] transition-colors duration-200">Science Olympiad</a></li>
                <li><a href="#" data-page="competitions" class="nav-link text-[#c9d1d9] hover:text-[#58a6ff] transition-colors duration-200">Competitions</a></li>
                <li><a href="#" data-page="register" class="nav-link text-[#c9d1d9] hover:text-[#58a6ff] transition-colors duration-200">Register</a></li>
            </ul>
        </nav>

        <!-- Dynamic Content Area -->
        <main id="content" class="min-h-[400px]">
            <!-- Content will be injected here -->
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;

        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                if (authToken) {
                    await signInWithCustomToken(auth, authToken);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase initialized and user authenticated.");
            } catch (error) {
                console.error("Error initializing Firebase or authenticating:", error);
            }
        }

        // Initialize Firebase on page load
        initFirebase();

        const contentDiv = document.getElementById('content');
        const navLinks = document.querySelectorAll('.nav-link');

        // Page content objects
        const pages = {
            'home': `
                <div class="text-center p-4">
                    <h2 class="text-3xl font-bold mb-4 text-[#58a6ff]">Welcome! ‚ú®</h2>
                    <p class="text-[#8b949e] leading-relaxed">I offer personalized tutoring to help students master core concepts in Mathematics and Science. Whether you're struggling with a specific topic or aiming for a top grade, I'm here to help you succeed.</p>
                    <a href="#details-section" class="mt-8 inline-block px-8 py-4 text-white font-semibold rounded-full shadow-lg transition-transform duration-300 transform hover:scale-105 bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Get Started/Learn More
                    </a>
                </div>
                <div id="details-section" class="p-4 mt-8">
                    <h2 class="text-3xl font-bold mb-4 text-[#58a6ff]">Details of My Tutoring Program üìö</h2>
                    <p class="text-[#8b949e] leading-relaxed mb-4">
                        My tutoring program is designed to provide a tailored learning experience for each student. I believe in fostering a deep understanding of concepts rather than just memorization. Here's what you can expect:
                    </p>
                    <ul class="list-disc list-inside space-y-3 text-[#8b949e]">
                        <li>
                            <span class="font-bold text-[#c9d1d9]">One-on-One Tutoring:</span> Each session is a personalized one-on-one meeting, allowing me to focus entirely on your needs.
                        </li>
                        <li>
                            <span class="font-bold text-[#c9d1d9]">Consistent Time Slot:</span> Tutoring is offered for exactly one hour per week. We will work together to book a consistent time that works for you each week to ensure steady progress.
                        </li>
                        <li>
                            <span class="font-bold text-[#c9d1d9]">Comprehensive Support:</span> Beyond our sessions, I'm available to answer quick questions and provide feedback on your work.
                        </li>
                        <li>
                            <span class="font-bold text-[#c9d1d9]">Proven Techniques:</span> I use a variety of teaching methods, including interactive exercises and real-world examples, to make complex subjects easy to understand.
                        </li>
                    </ul>
                    <p class="text-[#8b949e] leading-relaxed mt-4">
                        The registration process is designed to gather the necessary information to create the best possible plan for you. The form will ask about your academic interests, and allow you to select your preferred tutoring method‚Äîwhether in-person or virtual.
                    </p>
                    <a href="#" data-page="register" class="nav-link mt-8 inline-block px-8 py-4 text-white font-semibold rounded-full shadow-lg transition-transform duration-300 transform hover:scale-105 bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Go to Registration Form
                    </a>
                </div>
            `,
            'mathematics': `
                <div class="p-4">
                    <h2 class="text-3xl font-bold mb-4 text-[#58a6ff]">Mathematics Tutoring üìê</h2>
                    <p class="text-[#8b949e] leading-relaxed">I provide comprehensive tutoring for all levels of mathematics, from elementary school to advanced calculus. My approach focuses on building a strong foundation and developing problem-solving skills to tackle complex problems with confidence.</p>
                    <ul class="list-disc list-inside mt-4 text-[#8b949e] space-y-2">
                        <li><span class="text-[#58a6ff] font-bold">Elementary School Math</span> ‚ûï‚ûñ</li>
                        <li><span class="text-[#58a6ff] font-bold">Algebra I & II</span> üìà</li>
                        <li><span class="text-[#58a6ff] font-bold">Geometry</span> üìè</li>
                        <li><span class="text-[#58a6ff] font-bold">Trigonometry</span> ‚úçÔ∏è</li>
                        <li><span class="text-[#58a6ff] font-bold">Pre-Calculus</span> üìä</li>
                        <li><span class="text-[#58a6ff] font-bold">Integrated Math I, II & III</span> üìö</li>
                        <li><span class="text-[#58a6ff] font-bold">AP Calculus A/B</span> (Coming Soon!) üöÄ</li>
                    </ul>
                    <div class="mt-8 pt-4 border-t border-[#30363d]">
                        <h3 class="text-2xl font-bold mb-4 text-[#58a6ff]">My Qualifications üéì</h3>
                        <ul class="list-none space-y-3">
                            <li class="qualification-item"><span class="text-2xl mr-2">‚úÖ</span> Current Enrollment in AP Calculus A/B.</li>
                            <li class="qualification-item"><span class="text-2xl mr-2">‚úÖ</span> Self studying AP Calculus B/C.</li>
                        </ul>
                    </div>
                </div>
            `,
            'science-olympiad': `
                <div class="p-4">
                    <h2 class="text-3xl font-bold mb-4 text-[#58a6ff]">Science Olympiad üî¨</h2>
                    <p class="text-[#8b949e] leading-relaxed">I have extensive experience in Science Olympiad competitions and can help you prepare for specific events. I offer coaching and practice sessions to help you build your knowledge and competition skills.</p>
                    <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-[#21262d] p-4 rounded-lg">
                            <h3 class="font-bold text-[#58a6ff] mb-2">Division A üß†</h3>
                            <ul class="list-disc list-inside text-[#8b949e]">
                                <li>Map Reading</li>
                                <li>Estimania</li>
                                <li>Large Number Estimation</li>
                            </ul>
                        </div>
                        <div class="bg-[#21262d] p-4 rounded-lg">
                            <h3 class="font-bold text-[#58a6ff] mb-2">Division B üß™</h3>
                            <ul class="list-disc list-inside text-[#8b949e]">
                                <li>Solar System</li>
                                <li>Metric Mastery</li>
                            </ul>
                        </div>
                        <div class="bg-[#21262d] p-4 rounded-lg">
                            <h3 class="font-bold text-[#58a6ff] mb-2">Division C üõ†Ô∏è</h3>
                            <ul class="list-disc list-inside text-[#8b949e]">
                                <li>Engineering CAD</li>
                                <li>Astronomy</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 pt-4 border-t border-[#30363d]">
                        <h3 class="text-2xl font-bold mb-4 text-[#58a6ff]">My Qualifications üèÜ</h3>
                        <ul class="list-none space-y-3">
                            <li class="qualification-item"><span class="text-2xl mr-2">üèÖ</span> 3 years of experience and current enrollment in Division C.</li>
                            <li class="qualification-item"><span class="text-2xl mr-2">üèÖ</span> Over 15 medals (more than 5 of which were top 3s).</li>
                            <li class="qualification-item"><span class="text-2xl mr-2">ü•á</span> 1st Place in State Competition for Metric Mastery.</li>
                            <li class="qualification-item"><span class="text-2xl mr-2">ü•à</span> 2nd and 3rd place in regionals, 3rd place in state, for Reach For The Stars.</li>
                            <li class="qualification-item"><span class="text-2xl mr-2">ü•á</span> 1st Place in Regionals for Road Scholar.</li>
                        </ul>
                    </div>
                </div>
            `,
            'competitions': `
                <div class="p-4">
                    <h2 class="text-3xl font-bold mb-4 text-[#58a6ff]">Competition Preparation üß©</h2>
                    <p class="text-[#8b949e] leading-relaxed">I specialize in preparing students for academic competitions. I will help you develop the strategies and deep understanding needed to perform at your best.</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mt-8 text-center">
                        <div class="bg-[#21262d] p-4 rounded-lg flex flex-col items-center">
                            <span class="text-4xl">üßÆ</span>
                            <span class="mt-2 text-[#c9d1d9] font-medium">AMC 8/10</span>
                        </div>
                        <div class="bg-[#21262d] p-4 rounded-lg flex flex-col items-center">
                            <span class="text-4xl">ü¶ò</span>
                            <span class="mt-2 text-[#c9d1d9] font-medium">Math Kangaroo</span>
                        </div>
                        <div class="bg-[#21262d] p-4 rounded-lg flex flex-col items-center">
                            <span class="mt-2 text-[#c9d1d9] font-medium">MOEMS</span>
                        </div>
                        <div class="bg-[#21262d] p-4 rounded-lg flex flex-col items-center">
                            <span class="text-4xl">üß†</span>
                            <span class="mt-2 text-[#c9d1d9] font-medium">MathCounts</span>
                        </div>
                        <div class="bg-[#21262d] p-4 rounded-lg flex flex-col items-center">
                            <span class="text-4xl">‚ú®</span>
                            <span class="mt-2 text-[#c9d1d9] font-medium">And More!</span>
                        </div>
                    </div>
                    <div class="mt-8 pt-4 border-t border-[#30363d]">
                        <h3 class="text-2xl font-bold mb-4 text-[#58a6ff]">My Qualifications üèÖ</h3>
                        <ul class="list-none space-y-3">
                            <li class="qualification-item"><span class="text-2xl mr-2">üìù</span> 18/25 on the AMC 8.</li>
                            <li class="qualification-item"><span class="text-2xl mr-2">üìù</span> Active Competitor in the AMC 10.</li>
                            <li class="qualification-item"><span class="text-2xl mr-2">üìù</span> Former Competitor in MathCounts.</li>
                        </ul>
                    </div>
                </div>
            `,
            'register': `
                <div class="p-4">
                    <h2 class="text-3xl font-bold mb-4 text-[#58a6ff]">Register for Tutoring üìù</h2>
                    <p class="text-[#8b949e] leading-relaxed">Please fill out this form to register your interest. We'll get back to you with pricing and availability based on your needs.</p>
                    <div class="mt-4 p-4 rounded-lg bg-[#21262d] border border-[#30363d]">
                        <h4 class="font-bold text-[#c9d1d9] mb-2">Cost Information</h4>
                        <p class="text-sm text-[#8b949e]">Pricing is dependent on the subject and level of tutoring required. A general cost is $XX per hour, which we will confirm after reviewing your application.</p>
                        <h4 class="font-bold text-[#c9d1d9] mt-4 mb-2">Ways for Payment</h4>
                        <ul class="list-disc list-inside text-sm text-[#8b949e]">
                            <li>Venmo</li>
                            <li>PayPal</li>
                            <li>Zelle</li>
                        </ul>
                    </div>
                    <form id="registrationForm" class="mt-4 space-y-4">
                        <div>
                            <label for="studentName" class="block text-sm font-medium text-[#c9d1d9]">Student's Name*</label>
                            <input type="text" id="studentName" name="studentName" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required>
                        </div>
                        <div>
                            <label for="studentAge" class="block text-sm font-medium text-[#c9d1d9]">Student's Age*</label>
                            <input type="number" id="studentAge" name="studentAge" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required min="1" max="99">
                        </div>
                        <div>
                            <label for="parentName" class="block text-sm font-medium text-[#c9d1d9]">Parent's Name*</label>
                            <input type="text" id="parentName" name="parentName" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required>
                        </div>
                        <div>
                            <label for="studentEmail" class="block text-sm font-medium text-[#c9d1d9]">Student's Email Address</label>
                            <input type="email" id="studentEmail" name="studentEmail" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                        </div>
                        <div>
                            <label for="parentEmail" class="block text-sm font-medium text-[#c9d1d9]">Parent's Email Address*</label>
                            <input type="email" id="parentEmail" name="parentEmail" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required>
                        </div>
                        <div>
                            <label for="studentPhone" class="block text-sm font-medium text-[#c9d1d9]">Student's Phone Number</label>
                            <input type="tel" id="studentPhone" name="studentPhone" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                        </div>
                        <div>
                            <label for="parentPhone" class="block text-sm font-medium text-[#c9d1d9]">Parent's Phone Number*</label>
                            <input type="tel" id="parentPhone" name="parentPhone" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required>
                        </div>
                        <div>
                            <label for="class" class="block text-sm font-medium text-[#c9d1d9]">What class do you want?*</label>
                            <select id="class" name="class" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required>
                                <option value="" disabled selected>Select a class</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="science-olympiad">Science Olympiad</option>
                                <option value="competitions">Competitions</option>
                            </select>
                        </div>
                        <div id="class-details-container" class="hidden">
                            <label for="class-details" class="block text-sm font-medium text-[#c9d1d9]">What exactly in this class would you like to learn?*</label>
                            <select id="class-details" name="class-details" multiple size="5" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                            <p class="text-xs text-[#8b949e] italic mt-1">Hold down the Ctrl (Windows) or Cmd (Mac) key to select multiple options.</p>
                        </div>

                        <!-- In-Person Tutoring Question -->
                        <div>
                            <label class="block text-sm font-medium text-[#c9d1d9]">I want in-person tutoring*</label>
                            <div class="mt-2 space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="inPersonOption" value="yes" class="form-radio text-[#58a6ff]" required>
                                    <span class="ml-2 text-[#c9d1d9]">Yes</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="inPersonOption" value="no" class="form-radio text-[#58a6ff]" required>
                                    <span class="ml-2 text-[#c9d1d9]">No</span>
                                </label>
                            </div>
                            <p class="text-xs text-[#8b949e] italic mt-1">
                                *In-person tutoring is only available in the 92127 San Diego Zip Code.
                            </p>
                        </div>

                        <!-- Address fields (Hidden by default) -->
                        <div id="address-container" class="hidden space-y-4">
                            <div>
                                <label for="streetAddress" class="block text-sm font-medium text-[#c9d1d9]">Street Address*</label>
                                <input type="text" id="streetAddress" name="streetAddress" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                            </div>
                            <div>
                                <label for="city" class="block text-sm font-medium text-[#c9d1d9]">City*</label>
                                <input type="text" id="city" name="city" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                            </div>
                            <div>
                                <label for="state" class="block text-sm font-medium text-[#c9d1d9]">State*</label>
                                <input type="text" id="state" name="state" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                            </div>
                            <div>
                                <label for="zipCode" class="block text-sm font-medium text-[#c9d1d9]">Zip Code*</label>
                                <input type="text" id="zipCode" name="zipCode" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                            </div>
                        </div>

                        <!-- Online tutoring fields (Hidden by default) -->
                        <div id="online-container" class="hidden">
                            <label class="block text-sm font-medium text-[#c9d1d9]">What application would you like to use?*</label>
                            <div class="mt-2 space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="applicationOption" value="Zoom" class="form-radio text-[#58a6ff]">
                                    <span class="ml-2 text-[#c9d1d9]">Zoom</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="applicationOption" value="Google Meet" class="form-radio text-[#58a6ff]">
                                    <span class="ml-2 text-[#c9d1d9]">Google Meet</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="applicationOption" value="Other" class="form-radio text-[#58a6ff]">
                                    <span class="ml-2 text-[#c9d1d9]">Other</span>
                                </label>
                            </div>
                            <div id="other-app-container" class="hidden mt-2">
                                <label for="other-app" class="block text-sm font-medium text-[#c9d1d9]">Please specify:</label>
                                <input type="text" id="other-app" name="other-app" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                            </div>
                        </div>

                        <div>
                            <label for="paymentMethod" class="block text-sm font-medium text-[#c9d1d9]">Payment Method*</label>
                            <select id="paymentMethod" name="paymentMethod" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]" required>
                                <option value="" disabled selected>Select a method</option>
                                <option value="venmo">Venmo</option>
                                <option value="paypal">PayPal</option>
                                <option value="zelle">Zelle</option>
                            </select>
                        </div>
                        <div id="payment-handle-container" class="hidden">
                            <label id="payment-handle-label" for="payment-handle" class="block text-sm font-medium text-[#c9d1d9]"></label>
                            <input type="text" id="payment-handle" name="payment-handle" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]">
                        </div>
                        <div>
                            <label for="extraInfo" class="block text-sm font-medium text-[#c9d1d9]">Extra information I should know</label>
                            <textarea id="extraInfo" name="extraInfo" rows="4" class="mt-1 block w-full px-3 py-2 bg-[#21262d] border border-[#30363d] rounded-md text-white focus:outline-none focus:ring-[#58a6ff] focus:border-[#58a6ff]"></textarea>
                        </div>
                        <button type="submit" class="w-full px-4 py-2 text-white bg-[#58a6ff] rounded-md hover:bg-[#4894e6] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#58a6ff] transition-colors duration-200">Submit Registration</button>
                    </form>
                    <div id="submission-message" class="hidden mt-6 p-4 rounded-lg bg-green-900 border border-green-700 text-green-200">
                        <p class="font-bold">Form Submitted Successfully!</p>
                        <p class="text-sm mt-2">Your information has been successfully submitted to the database.</p>
                    </div>
                </div>
            `
        };

        // Define options for the dynamic class details dropdown
        const classOptions = {
            'mathematics': [
                "Elementary School Math", "Algebra I & II", "Geometry", "Trigonometry", "Pre-Calculus", "Integrated Math I, II & III", "AP Calculus A/B"
            ],
            'science-olympiad': [
                "Map Reading", "Estimania", "Large Number Estimation", "Solar System", "Metric Mastery", "Engineering CAD", "Astronomy"
            ],
            'competitions': [
                "AMC 8/10", "Math Kangaroo", "MOEMS", "MathCounts"
            ]
        };

        // Function to render page content
        const renderPage = (pageName) => {
            contentDiv.innerHTML = pages[pageName];
            attachFormListeners();
        };

        // Function to attach listeners after page content is rendered
        const attachFormListeners = () => {
            const registrationForm = document.getElementById('registrationForm');
            if (registrationForm) {
                registrationForm.addEventListener('submit', handleFormSubmit);
            }

            const classSelect = document.getElementById('class');
            const classDetailsContainer = document.getElementById('class-details-container');
            const classDetailsSelect = document.getElementById('class-details');
            const inPersonRadios = document.getElementsByName('inPersonOption');
            const addressContainer = document.getElementById('address-container');
            const onlineContainer = document.getElementById('online-container');
            const streetAddressInput = document.getElementById('streetAddress');
            const cityInput = document.getElementById('city');
            const stateInput = document.getElementById('state');
            const zipCodeInput = document.getElementById('zipCode');
            const applicationRadios = document.getElementsByName('applicationOption');
            const otherAppContainer = document.getElementById('other-app-container');
            const otherAppInput = document.getElementById('other-app');
            const paymentMethodSelect = document.getElementById('paymentMethod');
            const paymentHandleContainer = document.getElementById('payment-handle-container');
            const paymentHandleLabel = document.getElementById('payment-handle-label');
            const paymentHandleInput = document.getElementById('payment-handle');


            // Dynamic class details based on class selection
            if (classSelect) {
                classSelect.addEventListener('change', () => {
                    const selectedClass = classSelect.value;
                    classDetailsSelect.innerHTML = ''; // Clear previous options
                    if (selectedClass) {
                        classDetailsContainer.classList.remove('hidden');
                        classDetailsSelect.required = true;
                        classOptions[selectedClass].forEach(option => {
                            const opt = document.createElement('option');
                            opt.value = option;
                            opt.textContent = option;
                            classDetailsSelect.appendChild(opt);
                        });
                    } else {
                        classDetailsContainer.classList.add('hidden');
                        classDetailsSelect.required = false;
                    }
                });
            }

            // Show/hide address/online fields based on in-person choice
            inPersonRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'yes') {
                        addressContainer.classList.remove('hidden');
                        onlineContainer.classList.add('hidden');
                        streetAddressInput.required = true;
                        cityInput.required = true;
                        stateInput.required = true;
                        zipCodeInput.required = true;
                        applicationRadios.forEach(appRadio => appRadio.required = false);
                        otherAppInput.required = false;
                        otherAppContainer.classList.add('hidden');
                    } else {
                        addressContainer.classList.add('hidden');
                        onlineContainer.classList.remove('hidden');
                        streetAddressInput.required = false;
                        cityInput.required = false;
                        stateInput.required = false;
                        zipCodeInput.required = false;
                        applicationRadios.forEach(appRadio => appRadio.required = true);
                    }
                });
            });

            // Show/hide "Other" application text field
            applicationRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'Other') {
                        otherAppContainer.classList.remove('hidden');
                        otherAppInput.required = true;
                    } else {
                        otherAppContainer.classList.add('hidden');
                        otherAppInput.required = false;
                    }
                });
            });

            // Dynamic payment handle based on payment method selection
            if (paymentMethodSelect) {
                paymentMethodSelect.addEventListener('change', () => {
                    const selectedMethod = paymentMethodSelect.value;
                    if (selectedMethod) {
                        paymentHandleContainer.classList.remove('hidden');
                        paymentHandleInput.required = true;
                        switch (selectedMethod) {
                            case 'venmo':
                                paymentHandleLabel.textContent = 'Venmo Handle*';
                                paymentHandleInput.placeholder = 'e.g., @YourHandle';
                                break;
                            case 'paypal':
                                paymentHandleLabel.textContent = 'PayPal Username*';
                                paymentHandleInput.placeholder = 'e.g., your.username';
                                break;
                            case 'zelle':
                                paymentHandleLabel.textContent = 'Zelle Phone Number/Email*';
                                paymentHandleInput.placeholder = 'e.g., 555-555-5555 or your.email@example.com';
                                break;
                            default:
                                paymentHandleLabel.textContent = '';
                                paymentHandleInput.placeholder = '';
                                paymentHandleContainer.classList.add('hidden');
                                paymentHandleInput.required = false;
                                break;
                        }
                    } else {
                        paymentHandleContainer.classList.add('hidden');
                        paymentHandleInput.required = false;
                    }
                });
            }
        };

        const handleFormSubmit = async (e) => {
            e.preventDefault();
            const form = e.target;
            const data = new FormData(form);
            const submissionData = {};
            data.forEach((value, key) => {
                if (key === 'class-details') {
                    // Handle multi-select
                    const selectedOptions = Array.from(form.querySelector('#class-details').selectedOptions).map(option => option.value);
                    submissionData[key] = selectedOptions;
                } else if (key === 'inPersonOption' && value === 'yes') {
                    submissionData['tutoringLocation'] = 'In-Person';
                } else if (key === 'inPersonOption' && value === 'no') {
                    submissionData['tutoringLocation'] = 'Online';
                } else {
                    submissionData[key] = value;
                }
            });

            // Handle online application details
            if (submissionData.tutoringLocation === 'Online') {
                const applicationOption = form.querySelector('input[name="applicationOption"]:checked');
                if (applicationOption) {
                    if (applicationOption.value === 'Other') {
                        submissionData['application'] = form.querySelector('#other-app').value;
                    } else {
                        submissionData['application'] = applicationOption.value;
                    }
                }
            }

            // Save data to Firestore
            if (db) {
                try {
                    const userId = auth.currentUser?.uid;
                    const submissionsCollection = collection(db, `artifacts/${appId}/users/${userId}/submissions`);
                    const docRef = await addDoc(submissionsCollection, {
                        ...submissionData,
                        submittedAt: new Date(),
                    });
                    console.log("Document written with ID: ", docRef.id);
                    document.getElementById('submission-message').classList.remove('hidden');
                    form.reset();
                    document.getElementById('class-details-container').classList.add('hidden');
                    document.getElementById('address-container').classList.add('hidden');
                    document.getElementById('online-container').classList.add('hidden');
                    document.getElementById('other-app-container').classList.add('hidden');
                    document.getElementById('payment-handle-container').classList.add('hidden');
                } catch (e) {
                    console.error("Error adding document: ", e);
                    // You could add a user-facing error message here if needed
                }
            } else {
                console.error("Firestore database not initialized.");
            }
        };

        // Event listeners for navigation links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageName = e.target.dataset.page;
                renderPage(pageName);
            });
        });

        // Initial page load
        document.addEventListener('DOMContentLoaded', () => {
            renderPage('home');
        });
    </script>
</body>
</html>
